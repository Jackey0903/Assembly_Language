# Pong 双人对战游戏 - 项目说明文档

## 一、项目概述

### 1.1 项目名称
**Pong 双人对战游戏**（基于8086汇编语言的文本模式实现）

### 1.2 开发环境
- **汇编器**: MASM 5.0 (Microsoft Macro Assembler)
- **链接器**: Microsoft Overlay Linker 3.60
- **运行环境**: DOSBox 0.74-3 (macOS/Windows/Linux)
- **开发平台**: macOS
- **调试工具**: DOSBox内置调试器

### 1.3 项目功能
本项目实现了经典的Pong乒乓球游戏,主要功能包括:
- 双人实时对战
- 球拍上下移动控制
- 球与墙壁/球拍的碰撞检测
- 实时计分系统
- 先得3分者获胜
- 游戏速度可调节

---

## 二、核心功能实现

### 2.1 游戏逻辑架构

#### 2.1.1 主循环结构
```
游戏主循环:
1. 检查键盘输入 (check_input)
2. 更新球位置 (update_ball)
3. 绘制游戏画面 (draw_game)
4. 延时控制帧率 (delay)
5. 检查获胜条件
6. 重复循环
```

#### 2.1.2 数据结构设计
- **球的属性**: X坐标、Y坐标、X速度、Y速度
- **玩家属性**: X坐标、Y坐标、球拍高度、分数
- **游戏参数**: 场地尺寸、获胜分数、游戏速度

### 2.2 关键算法实现

#### 2.2.1 碰撞检测算法
**墙壁碰撞**:
```assembly
; Y轴碰撞检测(上下墙壁)
cmp ball_y, 2           ; 检查是否碰到顶部
jle bounce_y            ; 碰到则反弹
cmp ball_y, 23          ; 检查是否碰到底部
jge bounce_y            ; 碰到则反弹

bounce_y:
    neg ball_dy         ; 反转Y方向速度
```

**球拍碰撞**:
```assembly
; 检查X坐标是否在球拍区域
cmp ball_x, 3           ; 检查是否在玩家1区域
jg check_p2_logic

; 检查Y坐标是否在球拍高度范围内
mov al, ball_y
cmp al, p1_y            ; 比较球Y与球拍顶部
jl check_scoring        ; 未击中
mov bl, p1_y
add bl, p1_height       ; 计算球拍底部
cmp al, bl              ; 比较球Y与球拍底部
jg check_scoring        ; 未击中

; 击中球拍,反弹
mov ball_dx, 1          ; 向右反弹
```

#### 2.2.2 得分判定算法
```assembly
check_scoring:
    cmp ball_x, 0       ; 球是否从左侧出界
    jle p2_scores       ; 玩家2得分
    cmp ball_x, 79      ; 球是否从右侧出界
    jge p1_scores       ; 玩家1得分

p1_scores:
    inc p1_score        ; 分数加1
    call reset_ball     ; 重置球位置
```

#### 2.2.3 键盘输入处理
采用**非阻塞式**键盘检测,避免游戏卡顿:
```assembly
check_input proc
    mov ah, 01h         ; INT 16h功能01h: 检查键盘缓冲区
    int 16h
    jz input_done       ; 无按键则直接返回
    
    mov ah, 00h         ; 有按键则读取
    int 16h
    
    or al, 20h          ; 转小写(统一处理)
    cmp al, 'w'         ; 检查各个按键
    je p1_up
    ; ... 其他按键处理
```

### 2.3 显示系统实现

#### 2.3.1 文本模式绘图
使用**BIOS INT 10h**视频服务实现字符绘制:
```assembly
; 设置光标位置
set_cursor proc
    mov ah, 2           ; 功能02h: 设置光标
    mov bh, 0           ; 页号0
    ; DH=行, DL=列
    int 10h
    ret
set_cursor endp

; 打印字符
print_char proc
    mov ah, 0Eh         ; 功能0Eh: TTY字符输出
    mov bh, 0           ; 页号0
    ; AL=字符
    int 10h
    ret
print_char endp
```

#### 2.3.2 快速清屏技术
使用卷屏功能提高刷新效率:
```assembly
clear_screen_fast proc
    mov ax, 0600h       ; AH=06h(卷屏), AL=0(清空)
    mov bh, 07h         ; 黑底白字
    mov cx, 0100h       ; 左上角(1, 0)
    mov dx, 184Fh       ; 右下角(24, 79)
    int 10h             ; 执行清屏
    ret
clear_screen_fast endp
```

### 2.4 游戏速度控制

使用**双层循环延时**实现帧率控制:
```assembly
delay proc
    mov cx, 3           ; 外层循环3次
delay_outer:
    mov dx, 15000       ; 内层循环15000次
delay_inner:
    dec dx
    jnz delay_inner
    loop delay_outer
    ret
delay endp
```
总延时 = 外层循环次数 × 内层循环次数 = 3 × 15000 = 45000次循环

---

## 三、技术亮点

### 3.1 兼容性优化
- **文本模式实现**: 避免VGA图形模式在macOS DOSBox上的兼容性问题
- **非阻塞输入**: 使用INT 16h功能01h检测按键,保证游戏流畅运行
- **大小写兼容**: 通过`or al, 20h`统一处理大小写输入

### 3.2 代码优化
- **寄存器优化**: 合理使用AX、BX、CX、DX寄存器,减少内存访问
- **子程序设计**: 模块化设计,提高代码可读性和可维护性
- **边界检查**: 完善的边界条件判断,防止球拍移出屏幕

### 3.3 用户体验
- **实时响应**: 非阻塞输入保证按键即时响应
- **速度可调**: game_speed参数可根据不同电脑性能调整
- **视觉友好**: 使用ASCII 219实心块字符显示球拍,视觉效果清晰

---

## 四、使用说明

### 4.1 编译运行步骤

#### 在DOSBox中执行:
```bash
# 1. 挂载项目目录
mount c /Users/jack/work/Assembly_Language/Final_Program

# 2. 切换到C盘
c:

# 3. 编译源代码
masm pong.asm;

# 4. 链接生成可执行文件
link pong.obj;

# 5. 运行游戏
pong.exe
```

### 4.2 游戏操作说明

| 操作 | 按键 | 说明 |
|------|------|------|
| 玩家1向上 | W 或 w | 左侧球拍向上移动 |
| 玩家1向下 | S 或 s | 左侧球拍向下移动 |
| 玩家2向上 | I 或 i | 右侧球拍向上移动 |
| 玩家2向下 | K 或 k | 右侧球拍向下移动 |
| 退出游戏 | ESC | 任意时刻按ESC退出 |
| 开始游戏 | 任意键 | 游戏开始前按任意键 |

### 4.3 游戏规则
1. 双方各控制一个球拍(左侧/右侧)
2. 球在场地内来回弹跳
3. 用球拍接住球使其反弹
4. 球从对方一侧出界则得1分
5. 先得3分者获胜

### 4.4 参数调节

**调整游戏速度** (修改pong.asm):
```assembly
; 第32行: 调整内层循环次数
game_speed  dw 15000    ; 5000-20000(越大越慢)

; 第404行: 调整外层循环次数
mov cx, 3               ; 1-5(越大越慢)
```

**调整获胜分数**:
```assembly
; 第31行
win_score   db 3        ; 改为5、10等
```

---

## 五、项目总结

### 5.1 实现成果
- ✅ 完整实现Pong游戏核心功能
- ✅ 双人实时对战流畅运行
- ✅ 碰撞检测准确无误
- ✅ 兼容macOS DOSBox环境
- ✅ 代码规范,注释详尽(每行均有注释)

### 5.2 技术收获
1. **汇编语言编程**: 深入理解8086指令集和寄存器使用
2. **BIOS中断**: 熟练掌握INT 10h(视频)、INT 16h(键盘)、INT 21h(DOS)服务
3. **算法实现**: 碰撞检测、边界判断等游戏算法的底层实现
4. **性能优化**: 循环优化、寄存器使用优化等技巧
5. **调试能力**: 使用DOSBox调试汇编程序的技能

### 5.3 遇到的问题与解决

| 问题 | 解决方案 |
|------|----------|
| macOS DOSBox黑屏 | 使用文本模式替代VGA图形模式 |
| 键盘无响应/卡顿 | 改用非阻塞键盘检测(INT 16h功能01h) |
| 编译跳转超范围 | 简化跳转逻辑,使用就近标签 |
| 游戏速度过快 | 增加延时循环次数(外层3次,内层15000次) |

### 5.4 可扩展功能
- [ ] 添加单人模式(AI对手)
- [ ] 增加难度选择(球速、球拍大小)
- [ ] 添加音效(PC喇叭)
- [ ] 实现暂停/继续功能
- [ ] 记录历史最高分

---

## 六、附录

### 6.1 文件清单
- **pong.asm**: 游戏源代码(带完整注释)
- **pong.obj**: 编译生成的目标文件
- **pong.exe**: 可执行程序
- **项目说明文档.md**: 本文档

### 6.2 参考资料
- IBM PC汇编语言程序设计(第五版)
- 8086/8088汇编语言程序设计教程
- BIOS中断大全
- DOSBox官方文档

### 6.3 开发者信息
- **开发时间**: 2025年12月
- **测试环境**: macOS + DOSBox 0.74-3
- **代码行数**: 423行(含注释)
- **注释率**: 100%(每行均有注释)

---

## 七、项目亮点总结

### 核心技术特色
1. **完全基于BIOS中断**: 不依赖任何第三方库,纯汇编实现
2. **高效碰撞检测**: 精确的AABB碰撞检测算法
3. **流畅游戏体验**: 非阻塞输入+双层循环延时保证流畅性
4. **跨平台兼容**: 文本模式确保在各平台DOSBox上正常运行
5. **代码规范**: 完整注释(每行均有说明)、模块化设计

### 学习价值
- 深入理解计算机底层工作原理
- 掌握汇编语言编程思维
- 学习游戏开发的基本算法
- 提升代码调试和问题解决能力

---

**文档版本**: v1.0  
**最后更新**: 2025年12月10日
